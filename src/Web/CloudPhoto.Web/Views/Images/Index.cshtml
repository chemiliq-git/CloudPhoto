@using CloudPhoto.Web.ViewModels.Images
@model IEnumerable<ListImageViewModel>

@{
    ViewData["Title"] = "Index";
}


<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>

//use only form generate token
<form id="voteForm" method="post"></form>

<div class="container">
    <div class="row">
        @foreach (var item in @Model)
        {
            string likeIconColor = string.Empty;
            if(item.IsLike)
            {
                likeIconColor = "red";
            }

            <div class="col-md-4 m-image-container">
                <img src=@item.ImageUrl class="img-thumbnail">
                <a asp-action="Delete" asp-route-id=@item.Id class="my-icon-left">
                    <i class="far fa-times-circle"></i>
                </a>
                <a asp-action="Delete" asp-route-id=@item.Id class="my-icon-middle">
                    <i class="far fa-times-circle"></i>
                </a>
                <a href="#" class="my-like-icon-right" onclick="sendVote('@item.Id')">
                    <i id=@item.Id class="fas fa-heart" style="color:@likeIconColor;"></i>
                </a>

            </div>
        }
    </div>
</div>


@section Scripts {
    <script>

        function sendVote(imageId) {
            var token = $("#voteForm input[name=__RequestVerificationToken]").val();

            var formData = new FormData();
            formData.append("imageId", imageId);

            let style = document.getElementById(imageId).getAttribute('style');
            if (style.includes("red")) {
                formData.append("isLike", false);
            }
            else {
                formData.append("isLike", true);
            }

            $.ajax(
                {
                    url: "/api/votes",
                    data: formData,
                    processData: false,
                    contentType: false,
                    type: "POST",
                    headers: { 'X-CSRF-TOKEN': token },
                    success: function (data) {
                        if (data.result == true) {
                            if (style.includes("red")) {
                                document.getElementById(imageId).setAttribute("style", "color:");
                            }
                            else {
                                document.getElementById(imageId).setAttribute("style", "color:red");
                            }
                        }
                    }
                }
            );
        }

    </script>
}
